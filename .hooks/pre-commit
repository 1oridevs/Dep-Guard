#!/bin/bash

# Run Dependency Guardian check
echo "üîç Running Dependency Guardian check..."
dependency-guardian scan --format json > .dependency-check.tmp.json

# Check for high severity issues or forbidden licenses
HIGH_SEVERITY=$(jq '.summary.vulnerabilities["HIGH"] + .summary.vulnerabilities["CRITICAL"]' .dependency-check.tmp.json)
FORBIDDEN_LICENSES=$(jq '.summary.licenses["NON-COMPLIANT"]' .dependency-check.tmp.json)

if [ "$HIGH_SEVERITY" -gt 0 ] || [ "$FORBIDDEN_LICENSES" -gt 0 ]; then
    echo "‚ùå Dependency check failed!"
    echo "Found $HIGH_SEVERITY high/critical vulnerabilities and $FORBIDDEN_LICENSES forbidden licenses"
    echo "Please fix these issues before committing"
    rm .dependency-check.tmp.json
    exit 1
fi

rm .dependency-check.tmp.json
exit 0 